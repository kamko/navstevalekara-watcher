<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>navstevalekara.sk Watcher</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, Helvetica, sans-serif;
            background: #FFFFFF;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        .card {
            background: white;
            border: 2px solid #000000;
            padding: 32px;
        }
        h1 {
            color: #000000;
            margin-bottom: 8px;
            font-size: 32px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        .subtitle {
            color: #4A4A4A;
            margin-bottom: 32px;
            font-size: 14px;
        }
        .form-group {
            margin-bottom: 24px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #000000;
            font-weight: bold;
            font-size: 14px;
            text-transform: uppercase;
        }
        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #000000;
            border-radius: 0;
            font-size: 16px;
            font-family: Arial, Helvetica, sans-serif;
        }
        input:focus, textarea:focus {
            outline: none;
            border: 4px solid #000000;
        }
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        .help-text {
            font-size: 12px;
            color: #4A4A4A;
            margin-top: 4px;
        }
        button {
            width: 100%;
            background: #000000;
            color: #FFFFFF;
            border: 2px solid #000000;
            padding: 14px 24px;
            border-radius: 0;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        button:hover {
            background: #FFFFFF;
            color: #000000;
        }
        input[type="radio"] {
            appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid #000000;
            background: #FFFFFF;
            margin-right: 8px;
            cursor: pointer;
        }
        input[type="radio"]:checked {
            background: #000000;
        }
        input[type="radio"]:checked + span {
            font-weight: bold;
            color: #000000;
        }
        #datepicker {
            width: 100%;
            padding: 12px;
            border: 2px solid #000000;
            border-radius: 0;
            font-size: 14px;
            cursor: pointer;
            background: white;
        }
        #datepicker:focus {
            outline: none;
            border: 4px solid #000000;
        }
        .flatpickr-calendar {
            background: #FFFFFF !important;
            border: 2px solid #000000 !important;
            border-radius: 0 !important;
            box-shadow: none !important;
        }
        .flatpickr-months {
            background: #000000 !important;
            border-bottom: 2px solid #000000 !important;
        }
        .flatpickr-month, .flatpickr-current-month {
            color: #FFFFFF !important;
        }
        .flatpickr-prev-month, .flatpickr-next-month {
            color: #FFFFFF !important;
        }
        .flatpickr-prev-month:hover, .flatpickr-next-month:hover {
            background: #4A4A4A !important;
        }
        .flatpickr-weekdays {
            background: #F5F5F5 !important;
            border-bottom: 1px solid #000000 !important;
        }
        .flatpickr-weekday {
            color: #000000 !important;
            font-weight: bold !important;
            text-transform: uppercase !important;
            font-size: 11px !important;
        }
        .flatpickr-day {
            border: 1px solid #E5E5E5 !important;
            border-radius: 0 !important;
            color: #000000 !important;
        }
        .flatpickr-day.selected {
            background: #000000 !important;
            color: #FFFFFF !important;
            border: 2px solid #000000 !important;
            font-weight: bold !important;
        }
        .flatpickr-day.selected:hover {
            background: #000000 !important;
            color: #FFFFFF !important;
            border: 2px solid #000000 !important;
        }
        .flatpickr-day:hover {
            background: #F5F5F5 !important;
            border: 2px solid #000000 !important;
        }
        .flatpickr-day.disabled {
            color: #E5E5E5 !important;
        }
        .selected-dates-display {
            margin-top: 12px;
            padding: 12px;
            background: #F5F5F5;
            border: 2px solid #000000;
            min-height: 40px;
        }
        .selected-date-tag {
            display: inline-block;
            background: #FFFFFF;
            color: #000000;
            border: 2px solid #000000;
            padding: 6px 12px;
            margin: 4px;
            font-size: 13px;
            font-weight: bold;
            font-family: 'Courier New', Courier, monospace;
        }
        .no-dates-selected {
            color: #4A4A4A;
            font-size: 13px;
        }
        @media (max-width: 640px) {
            .card {
                padding: 16px;
            }
            h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>navstevalekara.sk Watcher</h1>
            <p class="subtitle">Vytvorte sledovanie voľných termínov u lekára</p>

            <form method="POST" action="/create" autocomplete="off">
                <div class="form-group">
                    <label for="doctor_url">URL lekára</label>
                    <input
                        type="url"
                        id="doctor_url"
                        name="doctor_url"
                        required
                        placeholder="https://www.navstevalekara.sk/lekari/.../meno-lekara-d15313.html"
                    >
                    <p class="help-text">Vložte celú URL adresu z navstevalekara.sk</p>
                </div>

                <div class="form-group">
                    <label for="datepicker">Sledované dátumy</label>
                    <input type="text" id="datepicker" style="display: none;">

                    <div id="selected-dates-display" class="selected-dates-display">
                        <span class="no-dates-selected">Zatiaľ nie sú vybrané žiadne dátumy</span>
                    </div>

                    <!-- Hidden inputs for form submission -->
                    <div id="hidden-dates-container"></div>
                </div>

                <!-- Typ notifikácie -->
                <div class="form-group">
                    <label>Typ notifikácie</label>
                    <div style="display: flex; gap: 24px; margin-bottom: 16px;">
                        <label style="display: flex; align-items: center; cursor: pointer; text-transform: none;">
                            <input type="radio" name="notification_type" value="email" checked onchange="toggleNotificationFields()" style="width: auto; margin-right: 8px;">
                            <span>Email</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer; text-transform: none;">
                            <input type="radio" name="notification_type" value="telegram" onchange="toggleNotificationFields()" style="width: auto; margin-right: 8px;">
                            <span>Telegram</span>
                        </label>
                    </div>
                </div>

                <!-- Telegram polia -->
                <div id="telegram-fields" style="display: none;">
                    <div class="form-group">
                        <label for="telegram_bot_token">Telegram Bot Token</label>
                        <input
                            type="text"
                            id="telegram_bot_token"
                            name="telegram_bot_token"
                            placeholder="1234567890:ABCdefGHIjklMNOpqrSTUvwxYZ"
                        >
                    </div>

                    <div class="form-group">
                        <label for="telegram_chat_id">Telegram Chat ID</label>
                        <input
                            type="text"
                            id="telegram_chat_id"
                            name="telegram_chat_id"
                            placeholder="-1001234567890"
                        >
                    </div>
                </div>

                <!-- Email polia -->
                <div id="email-fields">
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input
                            type="email"
                            id="email"
                            name="email"
                            placeholder="vas.email@example.com"
                        >
                        <p class="help-text">Dostanete notifikácie na tento email</p>
                    </div>
                </div>

                <button type="submit">Vytvoriť sledovanie</button>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        let selectedDates = [];

        function updateSelectedDatesDisplay() {
            const display = document.getElementById('selected-dates-display');
            const container = document.getElementById('hidden-dates-container');

            // Clear hidden inputs
            container.innerHTML = '';

            if (selectedDates.length === 0) {
                display.innerHTML = '<span class="no-dates-selected">Zatiaľ nie sú vybrané žiadne dátumy</span>';
            } else {
                // Sort dates
                const sortedDates = [...selectedDates].sort();

                // Display as tags
                display.innerHTML = sortedDates.map(date => {
                    const [year, month, day] = date.split('-');
                    return `<span class="selected-date-tag">${day}.${month}.${year}</span>`;
                }).join('');

                // Create hidden inputs for form submission
                sortedDates.forEach(date => {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = 'target_dates';
                    input.value = date;
                    input.required = true;
                    container.appendChild(input);
                });
            }
        }

        function toggleNotificationFields() {
            const type = document.querySelector('input[name="notification_type"]:checked').value;
            const telegramFields = document.getElementById('telegram-fields');
            const emailFields = document.getElementById('email-fields');
            const telegramToken = document.getElementById('telegram_bot_token');
            const telegramChat = document.getElementById('telegram_chat_id');
            const emailInput = document.getElementById('email');

            if (type === 'telegram') {
                telegramFields.style.display = 'block';
                emailFields.style.display = 'none';
                telegramToken.required = true;
                telegramChat.required = true;
                emailInput.required = false;
            } else {
                telegramFields.style.display = 'none';
                emailFields.style.display = 'block';
                telegramToken.required = false;
                telegramChat.required = false;
                emailInput.required = true;
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize notification fields
            toggleNotificationFields();

            // Initialize flatpickr
            const picker = flatpickr("#datepicker", {
                mode: "multiple",
                inline: true,
                minDate: "today",
                dateFormat: "Y-m-d",
                disableMobile: true,
                locale: {
                    firstDayOfWeek: 1,
                    weekdays: {
                        shorthand: ['Ne', 'Po', 'Ut', 'St', 'Št', 'Pi', 'So'],
                        longhand: ['Nedeľa', 'Pondelok', 'Utorok', 'Streda', 'Štvrtok', 'Piatok', 'Sobota']
                    },
                    months: {
                        shorthand: ['Jan', 'Feb', 'Mar', 'Apr', 'Máj', 'Jún', 'Júl', 'Aug', 'Sep', 'Okt', 'Nov', 'Dec'],
                        longhand: ['Január', 'Február', 'Marec', 'Apríl', 'Máj', 'Jún', 'Júl', 'August', 'September', 'Október', 'November', 'December']
                    }
                },
                onChange: function(selectedDatesObjects, dateStr, instance) {
                    selectedDates = selectedDatesObjects.map(date => {
                        const year = date.getFullYear();
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const day = String(date.getDate()).padStart(2, '0');
                        return `${year}-${month}-${day}`;
                    });
                    updateSelectedDatesDisplay();
                }
            });
        });
    </script>
</body>
</html>
